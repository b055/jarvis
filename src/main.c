/**
*****************************************************************************
**
**  File        : main.c
**
**  Abstract    : main and interrupt functions.
**
**  Functions   : main
**                Undefined_Handler
**                SWI_Handler
**                PAbort_Handler
**                DAbort_Handler
**                IRQ_Handler
**                FIQ_Handler
**
**  Environment : Atollic TrueSTUDIO(R)
**
**  Distribution: The file is distributed “as is,” without any warranty
**                of any kind.
**
**  (c)Copyright Atollic AB.
**  You may use this file as-is or modify it according to the needs of your
**  project. Distribution of this file (unmodified or modified) is not
**  permitted. Atollic AB permit registered Atollic TrueSTUDIO(R) users the
**  rights to distribute the assembled, compiled & linked contents of this
**  file as part of an application binary file, provided that it is built
**  using the Atollic TrueSTUDIO(R) toolchain.
**
**
*****************************************************************************
*/

/* Includes */
#include <stddef.h>
#include <stdlib.h>
#include <math.h>
#include <complex.h>
#include <stdio.h>
/* Private typedef */

/* Private define  */

/* Private macro */

/* Private variables */


void init(void);
/* Private functions */

/**
**===========================================================================
**
**  Abstract: main program
**
**===========================================================================
*/

int windowSize,hop,numberSlices,xlength,hopOut;
double alpha;
int step;
int debug = 0;
/* macros */
#define TWO_PI (6.2831853071795864769252867665590057683943L)

	/* function prototypes */
	void fft(int N, double (*x)[2], double (*X)[2]);
	void fft_rec(int N, int offset, int delta,
	             double (*x)[2], double (*X)[2], double (*XX)[2]);
	void ifft(int N, double (*x)[2], double (*X)[2]);

	double** createFrames(double * );
	double * fusionFrames(double **);
	double * synthesis(double *,double * );
	void process(double * , double*);
	double** analyse(double * currentFrame);
	double * interpolate(double * outputScaled);


double *phaseCumulative;
double ** magPhase;
double (*currentFrameWindowed)[2];
double (*currentFrameFFT)[2];
static const double wn[1024] = {2.35309521190441e-06,2.117772401805107e-05,5.882627289371944e-05,0.0001152973243923605,0.0001905887524106809,0.0002846977222691338,0.0003976206908180568,0.0005293534065715644,0.0006798909098673644,0.0008492275330535537,0.001037356900702002,0.001244271929848273,0.001469964830258519,0.001714427104722582,0.001977649549374016,0.002259622254036531,0.002560334602597192,0.002879775273406049,0.003217932239702348,0.003574792770067448,0.003950343428904102,0.004344570076942278,0.004757457871771453,0.005188991268399556,0.005639154019838111,0.006107929177713911,0.006595299092907236,0.007101245416216262,0.007625749099047896,0.008168790394134873,0.00873034885627938,0.00931040334312272,0.009908932015941285,0.0105259123404689,0.01116132108774504,0.01181513433498943,0.01248732746650294,0.01317787517459401,0.01388675146053187,0.01461392963552482,0.01535938232172573,0.01612308145326224,0.01690499827729375,0.01770510335509362,0.01852336656315806,0.01935975709433968,0.02021424345900774,0.02108679348623355,0.0219773743250018,0.02288595244544717,0.02381249364011706,0.02475696302525915,0.02571932504213487,0.02669954345835823,0.02769758136925987,0.02871340119927657,0.02974696470336585,0.03079823296844597,0.03186716641486087,0.03295372479787051,0.03405786720916593,0.03517955207840934,0.03631873717479944,0.03747537960866121,0.03864943583306069,0.0398408616454447,0.04104961218930475,0.04227564195586608,0.04351890478580089,0.04477935387096638,0.04605694175616687,0.04735162034094059,0.04866334088137059,0.04999205399191986,0.05133770964729084,0.05270025718430865,0.05407964530382864,0.05547582207266771,0.05688873492555968,0.05831833066713421,0.05976455547391962,0.06122735489636932,0.06270667386091194,0.06420245667202451,0.06571464701432955,0.06724318795471546,0.06878802194447969,0.07034909082149576,0.07192633581240276,0.07351969753481818,0.07512911599957373,0.07675453061297394,0.07839588017907728,0.08005310290200024,0.081726136388244,0.08341491764904341,0.08511938310273848,0.08683946857716823,0.08857510931208679,0.09032623996160155,0.09209279459663311,0.09387470670739806,0.09567190920591251,0.09748433442851817,0.09931191413842988,0.1011545795283044,0.1030122612228314,0.104884889281345,0.1067723932004571,0.1086747019167121,0.110591743809262,0.112523446702563,0.1144697378690931,0.1164305440320898,0.1184057913683094,0.120395405510806,0.1223993115517317,0.1244174340451568,0.1264496970099099,0.1284960239324391,0.1305563377696924,0.1326305609520183,0.1347186153860862,0.136820422457827,0.1389359030353923,0.1410649774721341,0.1432075656096032,0.1453635867805672,0.1475329598120475,0.1497156030283758,0.1519114342542685,0.1541203708179211,0.1563423295541204,0.158577226807376,0.1608249784350692,0.1630854998106219,0.165358705826682,0.1676445108983275,0.1699428289662898,0.1722535735001923,0.1745766575018095,0.1769119935083418,0.1792594935957084,0.1816190693818579,0.1839906320300955,0.1863740922524279,0.188769360312925,0.191176346031098,0.1935949587852951,0.1960251075161131,0.1984667007298259,0.2009196465018288,0.2033838524801001,0.2058592258886773,0.2083456735311509,0.2108431017941722,0.2133514166509788,0.2158705236649343,0.218400327993083,0.2209407343897219,0.2234916472099862,0.2260529704134499,0.228624607567742,0.2312064618521772,0.233798436061401,0.2364004326090493,0.2390123535314228,0.241634100491175,0.2442655747810147,0.2469066773274223,0.2495573086943795,0.2522173690871138,0.2548867583558544,0.2575653759996044,0.2602531211699235,0.262949892674725,0.265655588982086,0.2683701082240699,0.2710933482005614,0.2738252063831145,0.2765655799188128,0.2793143656341417,0.2820714600388723,0.2848367593299587,0.2876101593954456,0.290391555818388,0.2931808438807827,0.2959779185675107,0.2987826745702907,0.3015950062916448,0.304414807848873,0.3072419730780405,0.3100763955379744,0.312917968514271,0.3157665850233138,0.3186221378163014,0.321484519383285,0.3243536219572164,0.3272293375180054,0.3301115577965865,0.3330001742789953,0.3358950782104537,0.338796160599465,0.3417033122219171,0.3446164236251943,0.3475353851322988,0.3504600868459797,0.3533904186528707,0.3563262702276352,0.3592675310371209,0.3622140903445209,0.3651658372135424,0.3681226605125842,0.3710844489189206,0.3740510909228916,0.3770224748321027,0.3799984887756293,0.3829790207082283,0.3859639584145571,0.3889531895133982,0.3919466014618902,0.3949440815597651,0.3979455169535915,0.4009507946410231,0.4039598014750538,0.4069724241682767,0.4099885492971502,0.413008063306268,0.4160308525126344,0.419056803109944,0.4220858011728673,0.4251177326613392,0.4281524834248527,0.4311899392067569,0.4342299856485584,0.4372725082942269,0.4403173925945043,0.4433645239112178,0.4464137875215956,0.4494650686225861,0.4525182523351804,0.4555732237087377,0.4586298677253121,0.4616880693039842,0.464747713305193,0.4678086845350713,0.4708708677497822,0.4739341476598584,0.4769984089345427,0.4800635362061301,0.4831294140743112,0.4861959271105171,0.4892629598622652,0.4923303968575059,0.49539812260897,0.4984660216185169,0.5015339783814831,0.5046018773910299,0.5076696031424941,0.5107370401377347,0.5138040728894828,0.5168705859256888,0.5199364637938698,0.5230015910654573,0.5260658523401416,0.5291291322502178,0.5321913154649286,0.535252286694807,0.5383119306960158,0.5413701322746879,0.5444267762912622,0.5474817476648195,0.5505349313774138,0.5535862124784043,0.5566354760887822,0.5596826074054956,0.5627274917057731,0.5657700143514416,0.568810060793243,0.5718475165751472,0.5748822673386608,0.5779141988271326,0.5809431968900559,0.5839691474873655,0.5869919366937318,0.5900114507028497,0.5930275758317233,0.5960401985249462,0.5990492053589768,0.6020544830464084,0.6050559184402348,0.6080533985381098,0.6110468104866017,0.6140360415854429,0.6170209792917717,0.6200015112243706,0.6229775251678973,0.6259489090771084,0.6289155510810794,0.6318773394874158,0.6348341627864575,0.6377859096554791,0.6407324689628789,0.6436737297723647,0.6466095813471293,0.6495399131540202,0.6524646148677011,0.6553835763748057,0.6582966877780829,0.661203839400535,0.6641049217895463,0.6669998257210047,0.6698884422034135,0.6727706624819945,0.6756463780427835,0.678515480616715,0.6813778621836986,0.6842334149766861,0.6870820314857289,0.6899236044620255,0.6927580269219594,0.6955851921511269,0.6984049937083552,0.7012173254297092,0.7040220814324893,0.7068191561192172,0.7096084441816121,0.7123898406045543,0.7151632406700413,0.7179285399611277,0.7206856343658583,0.723434420081187,0.7261747936168854,0.7289066517994385,0.7316298917759301,0.7343444110179138,0.737050107325275,0.7397468788300765,0.7424346240003955,0.7451132416441456,0.7477826309128862,0.7504426913056204,0.7530933226725776,0.7557344252189853,0.7583658995088248,0.7609876464685772,0.7635995673909506,0.766201563938599,0.7687935381478228,0.7713753924322579,0.77394702958655,0.7765083527900136,0.7790592656102781,0.7815996720069169,0.7841294763350657,0.786648583349021,0.7891568982058277,0.7916543264688491,0.7941407741113227,0.7966161475199,0.7990803534981711,0.8015332992701741,0.8039748924838868,0.8064050412147048,0.8088236539689019,0.811230639687075,0.8136259077475719,0.8160093679699045,0.8183809306181422,0.8207405064042915,0.8230880064916581,0.8254233424981904,0.8277464264998078,0.8300571710337101,0.8323554891016725,0.8346412941733179,0.8369145001893781,0.8391750215649306,0.841422773192624,0.8436576704458796,0.8458796291820788,0.8480885657457315,0.8502843969716241,0.8524670401879524,0.8546364132194327,0.8567924343903968,0.8589350225278658,0.8610640969646076,0.8631795775421729,0.8652813846139138,0.8673694390479818,0.8694436622303074,0.8715039760675609,0.87355030299009,0.8755825659548433,0.8776006884482682,0.879604594489194,0.8815942086316906,0.8835694559679101,0.8855302621309068,0.8874765532974369,0.8894082561907379,0.8913252980832878,0.8932276067995428,0.895115110718655,0.8969877387771685,0.8988454204716955,0.9006880858615701,0.9025156655714817,0.9043280907940875,0.9061252932926018,0.9079072054033668,0.9096737600383985,0.9114248906879131,0.9131605314228317,0.9148806168972614,0.9165850823509566,0.918273863611756,0.9199468970979998,0.9216041198209226,0.923245469387026,0.9248708840004263,0.9264803024651818,0.9280736641875973,0.9296509091785041,0.9312119780555203,0.9327568120452845,0.9342853529856705,0.9357975433279755,0.9372933261390881,0.9387726451036306,0.9402354445260803,0.9416816693328658,0.9431112650744402,0.9445241779273323,0.9459203546961713,0.9472997428156913,0.9486622903527091,0.9500079460080801,0.9513366591186294,0.9526483796590594,0.9539430582438331,0.9552206461290336,0.9564810952141991,0.9577243580441339,0.9589503878106953,0.9601591383545552,0.9613505641669393,0.9625246203913387,0.9636812628252005,0.9648204479215906,0.965942132790834,0.9670462752021294,0.9681328335851391,0.969201767031554,0.9702530352966341,0.9712865988007234,0.9723024186307401,0.9733004565416418,0.9742806749578652,0.9752430369747409,0.9761875063598828,0.9771140475545528,0.9780226256749982,0.9789132065137665,0.9797857565409922,0.9806402429056603,0.9814766334368419,0.9822948966449063,0.9830950017227063,0.9838769185467378,0.9846406176782743,0.9853860703644751,0.9861132485394681,0.9868221248254059,0.9875126725334971,0.9881848656650105,0.988838678912255,0.9894740876595312,0.9900910679840587,0.9906895966568773,0.9912696511437207,0.9918312096058651,0.9923742509009521,0.9928987545837837,0.9934047009070928,0.993892070822286,0.9943608459801618,0.9948110087316004,0.9952425421282285,0.9956554299230578,0.9960496565710959,0.9964252072299326,0.9967820677602977,0.997120224726594,0.9974396653974028,0.9977403777459635,0.998022350450626,0.9982855728952774,0.9985300351697415,0.9987557280701518,0.9989626430992979,0.9991507724669464,0.9993201090901326,0.9994706465934284,0.9996023793091819,0.9997153022777309,0.9998094112475893,0.9998847026756077,0.9999411737271062,0.999978822275982,0.9999976469047881,0.9999976469047881,0.999978822275982,0.9999411737271062,0.9998847026756077,0.9998094112475893,0.9997153022777309,0.9996023793091819,0.9994706465934284,0.9993201090901327,0.9991507724669464,0.9989626430992979,0.9987557280701518,0.9985300351697415,0.9982855728952774,0.998022350450626,0.9977403777459635,0.9974396653974028,0.997120224726594,0.9967820677602977,0.9964252072299326,0.9960496565710959,0.9956554299230578,0.9952425421282285,0.9948110087316004,0.9943608459801618,0.993892070822286,0.9934047009070928,0.9928987545837837,0.9923742509009521,0.9918312096058651,0.9912696511437207,0.9906895966568774,0.9900910679840587,0.9894740876595312,0.988838678912255,0.9881848656650106,0.9875126725334971,0.9868221248254059,0.9861132485394681,0.9853860703644751,0.9846406176782743,0.9838769185467378,0.9830950017227063,0.9822948966449063,0.981476633436842,0.9806402429056603,0.9797857565409923,0.9789132065137665,0.9780226256749982,0.9771140475545528,0.9761875063598829,0.9752430369747409,0.9742806749578652,0.9733004565416419,0.9723024186307401,0.9712865988007235,0.9702530352966342,0.9692017670315541,0.9681328335851391,0.9670462752021294,0.9659421327908341,0.9648204479215906,0.9636812628252005,0.9625246203913388,0.9613505641669393,0.9601591383545554,0.9589503878106953,0.9577243580441339,0.9564810952141991,0.9552206461290336,0.9539430582438331,0.9526483796590595,0.9513366591186294,0.9500079460080801,0.9486622903527091,0.9472997428156914,0.9459203546961714,0.9445241779273323,0.9431112650744403,0.9416816693328659,0.9402354445260804,0.9387726451036307,0.9372933261390881,0.9357975433279755,0.9342853529856705,0.9327568120452845,0.9312119780555204,0.9296509091785042,0.9280736641875973,0.9264803024651819,0.9248708840004263,0.923245469387026,0.9216041198209227,0.9199468970979998,0.918273863611756,0.9165850823509567,0.9148806168972615,0.9131605314228318,0.9114248906879132,0.9096737600383986,0.907907205403367,0.9061252932926019,0.9043280907940876,0.9025156655714818,0.9006880858615702,0.8988454204716956,0.8969877387771686,0.895115110718655,0.8932276067995431,0.891325298083288,0.8894082561907382,0.8874765532974369,0.8855302621309069,0.8835694559679103,0.8815942086316906,0.8796045944891941,0.8776006884482683,0.8755825659548433,0.8735503029900901,0.8715039760675609,0.8694436622303077,0.8673694390479818,0.8652813846139138,0.8631795775421729,0.8610640969646077,0.8589350225278658,0.8567924343903969,0.8546364132194328,0.8524670401879526,0.8502843969716243,0.8480885657457315,0.8458796291820789,0.8436576704458797,0.841422773192624,0.8391750215649307,0.8369145001893781,0.8346412941733181,0.8323554891016725,0.8300571710337102,0.8277464264998078,0.8254233424981905,0.8230880064916584,0.8207405064042919,0.8183809306181421,0.8160093679699045,0.8136259077475723,0.8112306396870749,0.808823653968902,0.806405041214705,0.803974892483887,0.801533299270174,0.7990803534981712,0.7966161475199001,0.7941407741113229,0.7916543264688491,0.7891568982058279,0.7866485833490213,0.7841294763350657,0.781599672006917,0.7790592656102782,0.776508352790014,0.77394702958655,0.7713753924322579,0.7687935381478228,0.7662015639385993,0.7635995673909506,0.7609876464685772,0.7583658995088252,0.755734425218985,0.7530933226725777,0.7504426913056206,0.7477826309128865,0.7451132416441455,0.7424346240003956,0.7397468788300767,0.7370501073252753,0.7343444110179139,0.7316298917759302,0.7289066517994388,0.7261747936168853,0.7234344200811871,0.7206856343658585,0.7179285399611279,0.7151632406700412,0.7123898406045545,0.7096084441816122,0.7068191561192175,0.7040220814324893,0.7012173254297094,0.6984049937083554,0.6955851921511269,0.6927580269219594,0.6899236044620257,0.6870820314857292,0.6842334149766861,0.6813778621836987,0.6785154806167152,0.6756463780427835,0.6727706624819945,0.6698884422034135,0.6669998257210049,0.6641049217895462,0.661203839400535,0.6582966877780831,0.655383576374806,0.6524646148677011,0.6495399131540203,0.6466095813471295,0.6436737297723647,0.6407324689628789,0.6377859096554792,0.6348341627864578,0.6318773394874156,0.6289155510810795,0.6259489090771087,0.6229775251678976,0.6200015112243706,0.6170209792917718,0.6140360415854431,0.6110468104866016,0.6080533985381098,0.6050559184402349,0.6020544830464086,0.5990492053589767,0.5960401985249463,0.5930275758317235,0.59001145070285,0.5869919366937318,0.5839691474873656,0.5809431968900561,0.5779141988271325,0.5748822673386608,0.5718475165751473,0.5688100607932433,0.5657700143514415,0.5627274917057732,0.5596826074054958,0.5566354760887825,0.5535862124784043,0.5505349313774139,0.5474817476648197,0.5444267762912622,0.5413701322746879,0.5383119306960159,0.5352522866948072,0.5321913154649287,0.529129132250218,0.5260658523401418,0.5230015910654576,0.5199364637938699,0.5168705859256889,0.513804072889483,0.5107370401377347,0.5076696031424941,0.50460187739103,0.5015339783814833,0.4984660216185169,0.4953981226089701,0.4923303968575061,0.4892629598622655,0.4861959271105171,0.4831294140743113,0.4800635362061303,0.4769984089345426,0.4739341476598584,0.4708708677497823,0.4678086845350715,0.464747713305193,0.4616880693039843,0.4586298677253123,0.455573223708738,0.4525182523351805,0.4494650686225862,0.4464137875215958,0.4433645239112177,0.4403173925945043,0.437272508294227,0.4342299856485587,0.4311899392067569,0.4281524834248528,0.4251177326613395,0.4220858011728677,0.4190568031099441,0.4160308525126345,0.4130080633062683,0.4099885492971501,0.4069724241682767,0.4039598014750539,0.4009507946410235,0.3979455169535915,0.3949440815597652,0.3919466014618904,0.3889531895133985,0.3859639584145571,0.3829790207082284,0.3799984887756295,0.3770224748321026,0.3740510909228916,0.3710844489189207,0.3681226605125846,0.3651658372135424,0.362214090344521,0.3592675310371212,0.3563262702276355,0.3533904186528707,0.3504600868459798,0.347535385132299,0.3446164236251942,0.3417033122219171,0.3387961605994652,0.335895078210454,0.3330001742789953,0.3301115577965866,0.3272293375180056,0.3243536219572167,0.321484519383285,0.3186221378163015,0.3157665850233141,0.3129179685142709,0.3100763955379744,0.3072419730780407,0.3044148078488733,0.3015950062916448,0.2987826745702908,0.2959779185675109,0.2931808438807826,0.290391555818388,0.2876101593954457,0.2848367593299589,0.2820714600388722,0.2793143656341417,0.276565579918813,0.2738252063831148,0.2710933482005614,0.26837010822407,0.2656555889820862,0.2629498926747249,0.2602531211699235,0.2575653759996046,0.2548867583558546,0.2522173690871137,0.2495573086943796,0.2469066773274225,0.2442655747810151,0.241634100491175,0.2390123535314229,0.2364004326090495,0.2337984360614009,0.2312064618521772,0.2286246075677422,0.2260529704134501,0.2234916472099862,0.220940734389722,0.2184003279930831,0.2158705236649345,0.2133514166509789,0.2108431017941723,0.208345673531151,0.2058592258886773,0.2033838524801001,0.200919646501829,0.1984667007298261,0.1960251075161131,0.1935949587852952,0.1911763460310982,0.1887693603129252,0.1863740922524279,0.1839906320300956,0.1816190693818581,0.1792594935957084,0.1769119935083419,0.1745766575018097,0.1722535735001925,0.1699428289662897,0.1676445108983276,0.1653587058266821,0.1630854998106222,0.1608249784350693,0.158577226807376,0.1563423295541206,0.1541203708179211,0.1519114342542686,0.1497156030283759,0.1475329598120477,0.1453635867805672,0.1432075656096032,0.1410649774721343,0.1389359030353925,0.136820422457827,0.1347186153860863,0.1326305609520184,0.1305563377696924,0.1284960239324392,0.12644969700991,0.124417434045157,0.1223993115517317,0.120395405510806,0.1184057913683095,0.11643054403209,0.1144697378690931,0.1125234467025631,0.1105917438092622,0.1086747019167121,0.1067723932004571,0.1048848892813451,0.1030122612228316,0.1011545795283044,0.09931191413842994,0.09748433442851834,0.09567190920591268,0.09387470670739806,0.09209279459663317,0.09032623996160166,0.08857510931208679,0.08683946857716829,0.08511938310273859,0.08341491764904357,0.081726136388244,0.08005310290200029,0.07839588017907739,0.07675453061297416,0.07512911599957378,0.07351969753481824,0.07192633581240288,0.07034909082149576,0.06878802194447975,0.06724318795471557,0.06571464701432972,0.06420245667202445,0.062706673860912,0.06122735489636943,0.05976455547391979,0.05831833066713421,0.05688873492555974,0.05547582207266782,0.05407964530382858,0.05270025718430871,0.05133770964729095,0.04999205399192003,0.04866334088137059,0.04735162034094065,0.04605694175616698,0.04477935387096654,0.04351890478580095,0.04227564195586614,0.04104961218930486,0.0398408616454447,0.03864943583306074,0.03747537960866126,0.03631873717479955,0.03517955207840934,0.03405786720916598,0.03295372479787062,0.03186716641486081,0.03079823296844597,0.02974696470336591,0.02871340119927662,0.02769758136925987,0.02669954345835823,0.02571932504213492,0.02475696302525926,0.02381249364011706,0.02288595244544722,0.02197737432500185,0.02108679348623355,0.02021424345900774,0.01935975709433974,0.01852336656315812,0.01770510335509362,0.01690499827729375,0.0161230814532623,0.01535938232172585,0.01461392963552482,0.01388675146053187,0.01317787517459407,0.01248732746650288,0.01181513433498943,0.01116132108774504,0.01052591234046896,0.009908932015941285,0.00931040334312272,0.008730348856279435,0.008168790394134928,0.007625749099047896,0.007101245416216317,0.006595299092907292,0.006107929177713911,0.005639154019838111,0.005188991268399612,0.004757457871771509,0.004344570076942278,0.003950343428904157,0.003574792770067503,0.003217932239702348,0.002879775273406049,0.002560334602597192,0.002259622254036531,0.001977649549374016,0.001714427104722582,0.001469964830258519,0.001244271929848273,0.001037356900702002,0.0008492275330536092,0.00067989090986742,0.0005293534065715644,0.0003976206908180568,0.0002846977222691338,0.0001905887524106809,0.0001152973243923605,5.882627289371944e-05,2.117772401805107e-05,2.35309521190441e-06};
static double weird;
	int main(void)
	{
		int i = 0;
		double ** vector;
		double * x;
		double ** y;
		double ** outputy;
		double * timeStretched;
		double * previousPhaseFrame;
		double * synthesizedOutput;



		hop = 256;
		windowSize =1024;
		xlength = 2567574;
		step = 5;
		alpha = pow(2,(step/(float)12));
		hopOut = round(alpha*hop);
		numberSlices = ceil((double)((xlength-windowSize)/hop))+1;
		phaseCumulative = malloc(windowSize * sizeof(double));
		x = malloc(xlength * sizeof(double));

		outputy = malloc(numberSlices * sizeof(double *));
		outputy[0] = malloc(numberSlices * windowSize * sizeof(double));

		previousPhaseFrame = malloc(windowSize * sizeof(double));

		init();

		//reads fromt the file
		FILE *fopen(), *fp;

		fp = fopen("input.mat","r");
		int index =-1;
		while (!feof(fp))
		{
			index++;
			fscanf(fp,"%lg",&x[index]);
			if(debug == 1)
			{
				printf("%lg",x[index]);
				printf("%s","\n");
			}
		}
		fclose(fp);
		for(i = 1; i < numberSlices; i++)
			outputy[i] = outputy[0] + i * windowSize;

		y = createFrames(x);

		for(index = 0;index<windowSize;index++)
		{
			previousPhaseFrame[index] = 0;
		}
		for(index = 0;index<numberSlices;index++)
		{
			vector = analyse(y[index]);
			process(y[index],previousPhaseFrame);
			outputy[index] = synthesis(vector[0],vector[1]);
		//	printf("%s","end of the major loop\n");
		}
		timeStretched = fusionFrames(outputy);



		// do the linear interpolation
		synthesizedOutput = interpolate(timeStretched);

		for(i = 0;i<(xlength-1)/alpha+1;i++)
		{
			printf("%f",synthesizedOutput[i]);
			printf("%s","\n");
		}
		return 0;
	}





	/* creates the frames from the samples */
	double** createFrames(double * x)
	{
		int indexTimeStart,indexTimeEnd,i,j;
		double ** vectorFrames;

		vectorFrames = malloc(numberSlices * sizeof(double *));
		vectorFrames[0] = malloc(numberSlices * windowSize * sizeof(double));
		for(i = 1; i < numberSlices; i++)
		{
			vectorFrames[i] = vectorFrames[0] + i * windowSize;
		}


		for ( i = 0; i<numberSlices;i++)
		{
			indexTimeStart = (i)*hop;
			indexTimeEnd = indexTimeStart + windowSize;

			for(j = indexTimeStart;j<indexTimeEnd;j++)
			{
				vectorFrames[i][j-indexTimeStart] = x[j];
			}
		}

		if(debug ==1)
			for(i = 0;i<numberSlices;i++)
			{
				for(j = 0;j<windowSize;j++)
				{
					printf("%f",vectorFrames[i][j]);
					printf("%s"," ");
				}
				printf("%s","\n");
			}
		return vectorFrames;
	}


	/* merges the frames back together */
	double * fusionFrames(double **framesMatrix)
	{
		double * vectorTime;
		int timeIndex,index,j;
		vectorTime = malloc (xlength * sizeof(double));
		timeIndex = 0;
		for(index = 0;index<xlength;index++)
			vectorTime[index]=0;

		for (index=0;index<numberSlices;index++)
		{
			for(j = timeIndex;j<timeIndex+windowSize;j++)
			{
				if(debug == 1)
				{
					printf("%d",j);printf("%s"," ");
					//printf("%d",timeIndex+windowSize);
					printf("%s","\n");
				}
				vectorTime[j] +=framesMatrix[index][j-timeIndex];
			}
			timeIndex += hopOut;
		}
		return vectorTime;
	}

	double * interpolate(double * outputScaled)
	{
		int index;
		int aindex;
		double * inter;
		double temp = -alpha;
		int interlength = round(((xlength-1)/alpha))+1;
		inter = malloc(interlength * sizeof(double));

		int up,down;
		for(index = 0 ; index< interlength;index++)
		{

			temp +=alpha;
			down = floor(temp);
			up = ceil(temp);
			if(up == down)
			{
				inter[index] = outputScaled[index];
			}
			else if(up>=xlength)
			{
				inter[index] = outputScaled[down];
			}
			else
				inter[index] = outputScaled[down]+((temp - down)*(outputScaled[up]-outputScaled[down]))/(up-down);
			if(debug == 1)
			{
				printf("%f",inter[index]);
				printf("%s","\n");
			}
		}
		return inter;
	}

	/*
	 *

	%% Analysis

		% Get current frame to be processed
		currentFrame = y(index,:);

		% Window the frame
		currentFrameWindowed = currentFrame .* wn' / sqrt(((winSize/hop)/2));

		% Get the FFT
		currentFrameWindowedFFT = fft(currentFrameWindowed);

		% Get the magnitude
		magFrame = abs(currentFrameWindowedFFT);

		% Get the angle
		phaseFrame = angle(currentFrameWindowedFFT);

	 */

	double** analyse(double * currentFrame)
	{
		int index;
		int curindex = 0;
		for(index = 0;index<windowSize;index++)
		{
				currentFrameWindowed[0][index] = (currentFrame[index] * wn[index])/weird;
				currentFrameWindowed[1][index] = 0;
				if(debug ==1)
				{
					//printf("%f",currentFrame[index] );
					//printf("%s","  ");
					//printf("%d",curindex);
					//printf("%s","  ");
					//printf("%f",wn[curindex]);
					//printf("%s","  ");
					//printf("%f",currentFrame[index]);
					//printf("%s","  ");
					printf("%f",currentFrameWindowed[0][index]);
					printf("%s","  ");
					printf("%f",currentFrameWindowed[1][index]);
					printf("%s"," \n");
				}

		}
		if(debug ==1)
			printf("%s","listing from analyse \n");

		fft(windowSize<<1,currentFrameWindowed,currentFrameFFT);
		//magnitude32_32bIn(currentFrameFFt,windowSize*2);
		for(index = 0;index< windowSize;index++)
		{
			if(debug ==1)
			{
				printf("%f",currentFrameFFT[0][index]);
				printf("%s"," ");
				printf("%f",currentFrameFFT[1][index]);
				printf("%s","\n");
			}
			//considered getting these from the dude's library, but my head overheated
			magPhase[0][index] = sqrt(pow(currentFrameFFT[0][index],2) + pow(currentFrameFFT[1][index],2));
			magPhase[1][index]= atan(currentFrameFFT[1][index]/currentFrameFFT[0][index]);

		}
		return magPhase;
	}
	/*
	 *
	%% Processing

		% Get the phase difference
		deltaPhi = phaseFrame - previousPhase;
		previousPhase = phaseFrame;

		% Remove the expected phase difference
		deltaPhiPrime = deltaPhi - hop * 2*pi*(0:(winSize-1))/winSize;

		% Map to -pi/pi range
		deltaPhiPrimeMod = mod(deltaPhiPrime+pi, 2*pi) - pi;

		% Get the true frequency
		trueFreq = 2*pi*(0:(winSize-1))/winSize + deltaPhiPrimeMod/hop;

		% Get the final phase
			phaseCumulative = phaseCumulative + hopOut * trueFreq;

		% Remove the 60 Hz noise. This is not done for now but could be
		% achieved by setting some bins to zero.
	 *
	 */

	void process(double * phaseFrame, double* previousFrame)
	{
		int index;
		double * deltaPhi,* deltaPhiPrime,*deltaPhiPrimeMod,*trueFreq;
		deltaPhi = malloc(windowSize* sizeof(double));
		deltaPhiPrime = malloc(windowSize* sizeof(double));
		deltaPhiPrimeMod = malloc(windowSize* sizeof(double));
		trueFreq = malloc(windowSize* sizeof(double));
		//need to check whether these are vectors or not
		double precompute1 = hop * 2* M_PI/windowSize;
		double precompute2 = TWO_PI/windowSize;
		for(index = 0;index<windowSize;index++)
		{
			deltaPhi[index] = phaseFrame[index] - previousFrame[index];
			previousFrame[index] = phaseFrame[index];
			deltaPhiPrime[index] = deltaPhi[index] - precompute1 * index;

			deltaPhiPrimeMod[index] = fmod(deltaPhiPrime[index]+M_PI ,TWO_PI) -M_PI;
			trueFreq[index] = precompute2*index + deltaPhiPrimeMod[index]/hop;

			phaseCumulative[index] += hopOut+trueFreq[index];
			if(debug == 1)
			{
				printf("%f",phaseCumulative[index]);
				printf("%s","\n");
			}
		}
		free(deltaPhi);
		free(deltaPhiPrime);
		free(deltaPhiPrimeMod);
		free (trueFreq);
		if(debug == 1)
			printf("%s","finished the processing funcion\n");
	}

	/*
	 * %% Synthesis

		% Get the magnitude
		outputMag = magFrame;

		% Produce output frame
		outputFrame = real(ifft(outputMag .* exp(j*phaseCumulative)));

		% Save frame that has been processed
		outputy(index,:) = outputFrame .* wn' / sqrt(((winSize/hopOut)/2));
	 */

	double * synthesis(double *magFrame,double * phaseCumulative)
	{
		int index;
		double (*X)[2] = malloc(windowSize<<1*sizeof(double));
		for(index = 0; index <windowSize;index++)
		{
			X[0][index] = magFrame[index]*cos(phaseCumulative[index]);
			X[1][index] = magFrame[index]*sin(phaseCumulative[index]);
		}
		ifft(windowSize,X,X);

		for(index = 0;index<windowSize;index++)
		{
			magFrame[index] = X[0][index];
		}
		free(X);
		if(debug == 1)
			printf("%s","finishind the synthesis\n");
		return magFrame;
	}

	void init(void)
	{
		weird = sqrt(((windowSize/hop)>>1));
		magPhase = malloc(sizeof(double *)<<1);
		magPhase[0] = malloc(windowSize<<1 * sizeof(double));
		magPhase[1] = magPhase[0] + windowSize;
		currentFrameWindowed = malloc(windowSize<<1* sizeof(double));
		currentFrameFFT = malloc(windowSize<<1* sizeof(double));
	}



	/* FFT */
	void fft(int N, double (*x)[2], double (*X)[2])
	{
	  /* Declare a pointer to scratch space. */
	  double (*XX)[2] = malloc(2 * N * sizeof(double));

	  /* Calculate FFT by a recursion. */
	  fft_rec(N, 0, 1, x, X, XX);

	  /* Free memory. */
	  free(XX);
	}

	/* FFT recursion */
	void fft_rec(int N, int offset, int delta,
	             double (*x)[2], double (*X)[2], double (*XX)[2])
	{
	  int N2 = N/2;            /* half the number of points in FFT */
	  int k;                   /* generic index */
	  double cs, sn;           /* cosine and sine */
	  int k00, k01, k10, k11;  /* indices for butterflies */
	  double tmp0, tmp1;       /* temporary storage */

	  if(N != 2)  /* Perform recursive step. */
	    {
	      /* Calculate two (N/2)-point DFT's. */
	      fft_rec(N2, offset, 2*delta, x, XX, X);
	      fft_rec(N2, offset+delta, 2*delta, x, XX, X);

	      /* Combine the two (N/2)-point DFT's into one N-point DFT. */
	      for(k=0; k<N2; k++)
	        {
	          k00 = offset + k*delta;    k01 = k00 + N2*delta;
	          k10 = offset + 2*k*delta;  k11 = k10 + delta;
	          cs = cos(TWO_PI*k/(double)N); sn = sin(TWO_PI*k/(double)N);
	          tmp0 = cs * XX[k11][0] + sn * XX[k11][1];
	          tmp1 = cs * XX[k11][1] - sn * XX[k11][0];
	          X[k01][0] = XX[k10][0] - tmp0;
	          X[k01][1] = XX[k10][1] - tmp1;
	          X[k00][0] = XX[k10][0] + tmp0;
	          X[k00][1] = XX[k10][1] + tmp1;
	        }
	    }
	  else  /* Perform 2-point DFT. */
	    {
	      k00 = offset; k01 = k00 + delta;
	      X[k01][0] = x[k00][0] - x[k01][0];
	      X[k01][1] = x[k00][1] - x[k01][1];
	      X[k00][0] = x[k00][0] + x[k01][0];
	      X[k00][1] = x[k00][1] + x[k01][1];
	    }
	}

	/* IFFT */
	void ifft(int N, double (*x)[2], double (*X)[2])
	{
	  int N2 = N/2;       /* half the number of points in IFFT */
	  int i;              /* generic index */
	  double tmp0, tmp1;  /* temporary storage */

	  /* Calculate IFFT via reciprocity property of DFT. */
	  fft(N, X, x);
	  x[0][0] = x[0][0]/N;
	  x[0][1] = x[0][1]/N;
	  x[N2][0] = x[N2][0]/N;
	  x[N2][1] = x[N2][1]/N;
	  for(i=1; i<N2; i++)
	    {
	      tmp0 = x[i][0]/N;
	      tmp1 = x[i][1]/N;
	      x[i][0] = x[N-i][0]/N;
	      x[i][1] = x[N-i][1]/N;
	      x[N-i][0] = tmp0;
	      x[N-i][1] = tmp1;
	    }
	}
